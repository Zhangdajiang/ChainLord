# 第二天完整思路（审核用）

## 1. 我对需求的理解
目标是把“单 Agent 聊天”升级为“多 Agent 顺序协作 + 实时搜索”，让用户输入一个市场热点问题后：
- 先由“风险官”调用搜索工具拿到最新信息并总结风险点
- 再由“机会官”基于同样信息提出机会点
- 最后“和事佬”综合两边观点给出平衡建议

成功标准是：三段式输出清晰、逻辑顺序正确、信息基于实时搜索。

---

## 2. 关键决策与原因
1. **顺序协作优先**  
   - 多 Agent 并发更复杂、容易乱
   - 顺序输出更符合“谋士轮番说话”的体验

2. **第一 Agent 负责搜索**  
   - 搜索成本集中在一个入口，避免重复调用
   - 搜索结果可复用给后面两个 Agent，提高一致性

3. **保留单 Agent fallback**  
   - MCP 搜索不通时仍能聊天
   - 降低失败率，避免“全挂”

---

## 3. 设计结构（逻辑层）
### 3.1 角色定义
- **风险官**：查资料、列风险、保守视角
- **机会官**：基于相同资料，找机会点、给出乐观视角
- **和事佬**：综合冲突、给出折中建议

### 3.2 数据流
```
用户输入
   ↓
搜索结果 (MCP)
   ↓
风险官总结
   ↓
机会官总结
   ↓
和事佬总结（最终输出）
```

### 3.3 输出格式（建议）
- 风险官输出（标题 + 2-4 条要点）
- 机会官输出（标题 + 2-4 条要点）
- 和事佬输出（1 段综合建议）

---

## 4. 技术路线（代码层）
### 4.1 搜索工具接入（MCP）
目标：在代码里调用 SpoonOS 的 MCP 搜索工具，得到实时信息摘要。
初步方案：
- 读取 SpoonOS 官方 MCP 示例（确认调用方式）
- 设置搜索工具的 key（如 `TAVILY_API_KEY`）
- 把搜索结果整理为结构化文本传给后续 Agent

### 4.2 Agent 实现方式
两种可选：
1. **轻量方案（推荐）**  
   - 仍用单个 ChatBot  
   - 通过不同 system prompt 模拟三个 Agent  
   - 优点：实现快、风险低  
   - 缺点：不是真正的多 Agent 实例

2. **多实例方案（后续升级）**  
   - 为风险官、机会官、和事佬各建一个 ChatBot 实例  
   - 统一使用 DeepSeek，避免模型差异干扰  
   - 优点：更贴近多 Agent 架构  
   - 缺点：调用成本更高、错误面更多

### 4.3 UI 展示
- 侧边栏：新增“模式选择”
  - 单 Agent（默认）
  - 多 Agent（谋士团）
- 主界面：按顺序展示三段回复
  - 风险官（红色）
  - 机会官（绿色）
  - 和事佬（蓝色）

---

## 5. 明日具体执行步骤
1. 查 SpoonOS MCP 示例，确认搜索调用方式  
2. 编写 `search_news(query)` 函数  
3. 实现 `risk_agent_reply()`  
4. 实现 `chance_agent_reply()`  
5. 实现 `mediator_reply()`  
6. UI 按顺序渲染三段输出  
7. 加入 fallback：MCP 失败时走单 Agent  

---

## 6. 风险点与对策
1. MCP 搜索调用失败  
   - 对策：fallback 为单 Agent  
2. 搜索结果太长  
   - 对策：先摘要再传给 Agent  
3. 成本过高  
   - 对策：限制输入长度、缓存搜索结果  

---

## 7. 验收标准（Day 2）
- 输入一个热点问题
- 三段输出按顺序出现
- 输出内容包含实时搜索信息
- MCP 失败时仍可正常聊天

---

## 8. 结论
明天优先保证“顺序三 Agent + MCP 搜索”最小闭环，先跑通再优化。  
完成后再考虑更复杂的多 Agent 架构与更丰富的搜索源。
